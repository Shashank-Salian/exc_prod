import{o as e,h as c,_ as P,p as y,S as $,b as _,r as d,g as L,B as x}from"./utils-609fe6b6.js";import{u as N,P as S,C as j,a as B,N as V}from"./Nav-9f1167dd.js";import{u as b,P as E}from"./usePagination-07868a01.js";import"./MarkdownEditor.module-37fbe7f1.js";const H="_container_lx541_1",F="_main_lx541_11",I={container:H,main:F},J="_container_1u6ph_1",R="_headContainer_1u6ph_13",q="_x_1u6ph_25",M="_left_1u6ph_33",T="_right_1u6ph_45",Z="_icon_1u6ph_53",A="_participants_1u6ph_69",X="_desc_1u6ph_93",G="_joinBtn_1u6ph_103",O="_pad_1u6ph_113",o={container:J,headContainer:R,x:q,left:M,right:T,icon:Z,participants:A,desc:X,joinBtn:G,pad:O},W=n=>e("svg",{height:n.width||"64",width:n.width||"64",className:n.className,fill:"none",viewBox:"0 0 64 64",xmlns:"http://www.w3.org/2000/svg",children:[e("path",{d:"M5.48126 10.8145C6.85652 9.43924 8.72179 8.66663 10.6667 8.66663H27.3334C28.4379 8.66663 29.3334 9.56206 29.3334 10.6666V10.6666C29.3334 11.7712 28.4379 12.6666 27.3334 12.6666H10.6667C9.78265 12.6666 8.93481 13.0178 8.30968 13.6429C7.68456 14.2681 7.33337 15.1159 7.33337 16V53.3333C7.33337 54.2174 7.68456 55.0652 8.30968 55.6903C8.9348 56.3154 9.78265 56.6666 10.6667 56.6666H48C48.8841 56.6666 49.7319 56.3154 50.3571 55.6903C50.9822 55.0652 51.3334 54.2174 51.3334 53.3333V36.6666C51.3334 35.5621 52.2288 34.6666 53.3334 34.6666V34.6666C54.4379 34.6666 55.3334 35.5621 55.3334 36.6666V53.3333C55.3334 55.2782 54.5608 57.1435 53.1855 58.5187C51.8102 59.894 49.945 60.6666 48 60.6666H10.6667C8.72179 60.6666 6.85653 59.894 5.48126 58.5187C4.10599 57.1435 3.33337 55.2782 3.33337 53.3333V16C3.33337 14.055 4.10599 12.1898 5.48126 10.8145Z",fill:"black",fillRule:"evenodd"}),e("path",{d:"M53.3333 7.00977C52.3634 7.00977 51.4333 7.39504 50.7475 8.08083L25.8059 33.0225L24.082 39.9179L30.9775 38.194L55.9191 13.2524C56.6049 12.5666 56.9902 11.6365 56.9902 10.6666C56.9902 9.69676 56.6049 8.76663 55.9191 8.08083C55.2333 7.39504 54.3032 7.00977 53.3333 7.00977ZM47.9191 5.25241C49.355 3.81647 51.3026 3.00977 53.3333 3.00977C55.364 3.00977 57.3116 3.81647 58.7475 5.25241C60.1834 6.68834 60.9902 8.63589 60.9902 10.6666C60.9902 12.6973 60.1834 14.6449 58.7475 16.0808L33.4142 41.4142C33.1579 41.6705 32.8367 41.8523 32.485 41.9402L21.8184 44.6069C21.1368 44.7773 20.4158 44.5776 19.9191 44.0808C19.4223 43.5841 19.2226 42.8631 19.393 42.1815L22.0597 31.5149C22.1476 31.1632 22.3294 30.8421 22.5857 30.5857L47.9191 5.25241Z",fill:"black",fillRule:"evenodd"})]}),z=({data:n})=>{const[h,p]=c([]),[w,l]=c(!1),[g,s]=c(!1),u=P(1),C=async()=>{try{s(!0),l(!0);const m=await(await d(`/api/community/posts/${n.name}/?page=${u.current}`)).json();if(l(!1),console.log(m),m.ok){if(m.code==="END_OF_PAGE"){s(!0);return}s(!1),p(f=>[...f,...m.data]);return}s(!1),alert("Couldn't fetch posts")}catch(r){s(!1),l(!1),console.error(r),alert("Couldn't fetch posts, something went wrong!")}};return y(()=>{C()},[]),b(null,100,()=>{u.current++,C()},g),e("div",{className:`${o.container} drop-shadow`,children:[e(K,{data:n}),e("div",{className:o.pad,children:[e("h2",{children:"Posts :"}),h.length===0?w?e("div",{className:"flx-c",children:e($,{})}):e("h1",{className:"mt-40",style:{textAlign:"center"},children:"No posts found"}):h.map(r=>e(E,{postData:r},r.id))]})]})},K=({data:n})=>{const[h,p]=c([]),[w,l]=c(!1),[g,s]=c(!1),[u,C]=c(),r=async()=>{try{const t=await(await d(`/api/community/leave/${n.name}/`)).json();if(t.ok){alert(t.message),location.reload();return}alert(t.message)}catch(a){console.error(a),alert("Something wen't wrong")}},m=async()=>{try{const t=await(await d(`/api/community/join/${n.name}/`)).json();if(t.ok){location.reload();return}alert(t.message)}catch(a){console.error(a),alert("Something wen't wrong")}},f=async()=>{try{const t=await(await d(`/api/community/participants/${n.name}/`)).json();if(t.ok){p(t.data),l(!0);return}alert(t.message)}catch(a){console.error(a),alert("Something wen't wrong")}},v=()=>{l(!1)},k=async a=>{console.log(a);try{const i=await(await d(`/api/community/removeparticipant/${n.name}?user=${a}`)).json();if(i.ok){alert(i.message),p(i.data);return}alert(i.message)}catch(t){console.error(t),alert("Something wen't wrong")}};N(e(j,{fw:!0,heading:"Participants :",boldHead:!0,icon:"close",onIconClick:v,children:e(S,{items:h.map(a=>({name:a.username,icon:a.avatar,desc:a.name,link:`/s/${a.username}`,rhs:n.moderator===a.username?"M":n.moderator===(__userData==null?void 0:__userData.username)?e(_,{color:"red",onClick:()=>k(a.username),children:"Remove"}):void 0}))})}),{show:w,onBackdropClick:v});const D=()=>{s(a=>!a)};return y(()=>{const a=async()=>{const t=await fetch(`${n.iconPath}/`,{headers:new Headers({"X-CSRFToken":L("csrftoken")||""}),redirect:"manual"});console.log(t);const i=await t.blob();console.log(i),t.headers.get("image-found")==="true"&&C(new File([i],`${n.name}.png`,{type:"image/png"}))};__userData.username===n.moderator&&a()},[]),n.moderator===__userData.username&&N(e(B,{update:!0,defaultVal:{commName:n.name,description:n.description,topic:n.topic,icon:u},onCloseClick:D}),{show:g}),e("div",{className:`${o.headContainer} ${o.pad} lite-shadow`,children:[e("div",{className:o.left,children:[e("div",{className:"mr-20",children:e("img",{className:`${o.icon} lite-shadow`,src:n.iconPath,alt:n.name})}),e("div",{className:"mr-20",children:[e("div",{children:[e("h2",{children:[e("span",{className:o.x,children:"x/"}),n.name,n.moderator===__userData.username?e(_,{className:"ml-40 flx-c",onClick:D,noPad:!0,color:"transp",children:e(W,{width:"28"})}):null]}),e("span",{children:["Topic : ",e("span",{style:{fontWeight:"600"},children:n.topic})]})]}),e("p",{className:`mt-10 ${o.desc}`,children:n.description})]})]}),e("div",{className:o.right,children:[e(_,{onClick:f,color:"transp",className:`${o.participants} mr-20`,children:[e("span",{children:"participants"}),e("h2",{children:n.participantsCount})]}),e("div",{children:e(_,{className:o.joinBtn,color:n.userJoined?"red":void 0,onClick:n.userJoined?r:m,children:n.userJoined?"Leave":"Join"})})]})]})},Q=()=>__communityData?(console.log(__communityData),y(()=>{document.title=__communityData.name},[]),e("div",{className:`${I.container} main`,children:[e(V,{}),e("main",{className:"container pad",children:[e("h2",{className:"mb-30",children:"Community :"}),e(z,{data:__communityData})]})]})):e("span",{children:"Community not found or internal server error"});x(e(Q,{}),document.getElementById("root"));
