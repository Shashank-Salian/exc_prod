import{o as t,B as x,h as g,_ as v,p as E,I as j,b as O,r as w,d as _}from"./utils-f1dc011d.js";import{N as B,F as q}from"./Nav-31bd0bdf.js";import{M as z}from"./MarkdownEditor-d3f59586.js";import"./MarkdownEditor.module-37fbe7f1.js";const R="_container_ka1yg_1",W="_inpContainer_ka1yg_11",A="_markdownContainer_ka1yg_25",L="_markdown_ka1yg_25",G="_filesContainer_ka1yg_41",H="_btnContainer_ka1yg_49",J="_message_ka1yg_59",l={container:R,inpContainer:W,markdownContainer:A,markdown:L,filesContainer:G,btnContainer:H,message:J},K="_select_kuzwr_1",Q={select:K},U=s=>{var m;return t("select",{name:s.name,id:s.id,onInput:s.onInput,value:s.value,className:`lite-shadow ${s.className||""} ${Q.select}`,children:[s.noEmpty?null:t("option",{value:"",children:"---"}),(m=s.options)==null?void 0:m.map((i,f)=>t("option",{value:i.value,children:i.name},f))]})},V=()=>{const[s,m]=g(""),[i,f]=g(),[N,I]=g([]),[d,r]=g(),[u,D]=g(),p=v(),y=async(e,n=!1)=>{try{r({message:n?"Saving...":"Drafting...",type:"normal"});const a=await(await w(`/api/posts/${n?"save":"draft"}/`,e,"POST")).json();if(console.log(a),a.ok){r({message:n?"Saved":"Drafted",type:"success"}),n&&(m(""),f(""),p.current.setMarkdown(""),window.location.pathname="/");return}r({message:"Couldn't save, check if the post is valid",type:"error"})}catch(o){console.log(o),r({message:"Something went wrong",type:"error"})}},C=v(_(async e=>{y(e)},2e3)),F=v(_(e=>{console.log(e==="");const n=new FormData;e!=null&&(n.append("body",e),y(n))},2e3));E(()=>{const e=async()=>{var c;const a=await(await w("/api/community/mycommunities/")).json();if(console.log(a),!(a!=null&&a.error)){if(((c=a==null?void 0:a.data)==null?void 0:c.length)===0){console.log("no communities");return}I(a.data.map(k=>({name:k.name,value:k.name})))}},n=async()=>{var c;const a=await(await w("/api/posts/draft/")).json();console.log(a),a.ok&&(a.data.title&&m(a.data.title),a.data.communityName&&f(a.data.communityName),a.data.body&&((c=p.current)==null||c.setMarkdown(a.data.body)))};e(),n()},[]);const T=e=>{f(()=>{const n=e.currentTarget.value,o=new FormData;return o.append("community",n),C.current(o),n})},b=e=>{m(()=>{const n=e.currentTarget.value,o=new FormData;return o.append("title",n),C.current(o),n})},M=()=>{var e;console.log("something happened"),F.current((e=p.current)==null?void 0:e.getMarkdown())},P=(e,n)=>{(async()=>{const a=new FormData,c=new File([e],e.name.replace(/\s/g,""),{type:e.type});a.append("image",c);const h=await(await w("/api/posts/image/",a,"POST")).json();h.ok&&n(`${h.data}`,""),h.error&&r({message:h.message,type:"error"})})().catch(()=>{alert("Something went wrong while uploading image")})},S=e=>{if(e.currentTarget.files&&e.currentTarget.files.length>0){const n=e.currentTarget.files;if(n.length>5){r({message:"Maximum 5 files allowed",type:"error"});return}for(let o of n)if(!o.name.endsWith(".pdf")){r({message:"Only PDF files are allowed",type:"error"});return}D(()=>{if(n){const o=[];for(let a of n)o.push(a);return console.log(o),o}})}},$=async()=>{var n;const e=new FormData;if(console.log(s,i,p),console.log(u),s.length<3||s.length>100||i===void 0){r({message:"Title and community are required and must be valid",type:"error"});return}if(e.append("title",s),e.append("body",(n=p.current)==null?void 0:n.getMarkdown()),e.append("community",i),u)for(const o of u)e.append("notes",o);y(e,!0)};return t("div",{className:`${l.container} main`,children:[t(B,{}),t("main",{className:"container pad",children:[t("h2",{className:"mb-20",children:"Create Post :"}),t("div",{className:l.inpContainer,children:[t("span",{className:"mr-30",children:"Choose community :"}),t(U,{options:N,value:i,onInput:T}),t("span",{children:"Choose title :"}),t(j,{value:s,maxLength:100,placeholder:"Enter title for your post",onInput:b})]}),t("div",{className:"mt-30",children:[t("span",{children:"Post contents :"}),t("div",{className:l.markdownContainer,children:[t(z,{className:`mt-20 ${l.markdown}`,onEditorInitialized:e=>{p.current=e},onInput:M,onImageInput:P}),t("div",{className:`${l.filesContainer} ml-20`,children:[t("p",{className:"mb-20",children:"Attach notes :"}),t(q,{text:"Notes",multiple:!0,width:"100px",accept:".pdf",placeholder:t("ul",{style:{maxWidth:"120px"},className:"mt-20",children:u==null?void 0:u.map((e,n)=>t("li",{style:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},title:e.name,children:e.name},n))}),onInput:S})]})]})]}),t("div",{className:`mt-30 ${l.btnContainer}`,children:[t("span",{"data-type":d==null?void 0:d.type,className:l.message,children:d==null?void 0:d.message}),t(O,{onClick:$,children:"Submit"})]}),t("span",{children:"Note: PDF files won't be drafted!"})]})]})};x(t(V,{}),document.getElementById("root"));
