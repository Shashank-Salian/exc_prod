import{B as I,o,h as g,_,p as T,b as M,S as x,r as d,d as B}from"./utils-609fe6b6.js";import{N as O,F as R}from"./Nav-9f1167dd.js";import{u as b,P as D}from"./usePagination-07868a01.js";import{M as j}from"./MarkdownEditor-fab5c365.js";import"./MarkdownEditor.module-37fbe7f1.js";const E="_container_ipy95_1",A="_postContainer_ipy95_11",W="_editor_ipy95_19",q="_editorContainer_ipy95_29",z="_footer_ipy95_37",i={container:E,postContainer:A,editor:W,editorContainer:q,footer:z},G=()=>{if(!__postData)return o("span",{children:"Post not found or internal server error"});const[l,N]=g(),[s,n]=g(null),[c,P]=g(null),[S,p]=g(!1),m=_(),h=_(1),C=t=>{if(t.currentTarget.files&&t.currentTarget.files.length>0){const e=t.currentTarget.files;if(e.length>5){n({message:"Maximum 5 files allowed",type:"error"});return}for(let r of e)if(!r.name.endsWith(".pdf")){n({message:"Only PDF files are allowed",type:"error"});return}N(()=>{if(e){const r=[];for(let a of e)r.push(a);return console.log(r),r}})}},k=async()=>{var t;try{const e=(t=m.current)==null?void 0:t.getMarkdown(),r=new FormData;if(r.append("body",e),l)for(const w of l)r.append("notes",w);const f=await(await d(`/api/posts/reply/${__postData.id}/`,r,"POST")).json();f.ok&&location.reload(),n({message:f.message,type:"error"})}catch(e){console.error(e),alert("Something went wrong while replying")}},v=(t,e)=>{(async()=>{const a=new FormData,f=new File([t],t.name.replace(/\s/g,""),{type:t.type});a.append("image",f),a.append("replyTo",__postData.id.toString());const u=await(await d("/api/posts/image/",a,"POST")).json();u.ok&&e(`${u.data}`,""),n({message:u.message,type:"error"})})().catch(()=>{alert("Something went wrong while uploading image")})},F=async()=>{var t;try{const e=new FormData;e.append("body",(t=m.current)==null?void 0:t.getMarkdown()),e.append("replyTo",__postData.id.toString()),n({message:"Drafting...",type:"normal"});const a=await(await d("/api/posts/draft/",e,"POST")).json();if(console.log(a),a.ok){n({message:"Drafted",type:"success"});return}n({message:a.message,type:"error"})}catch(e){console.log(e),n({message:"Something went wrong",type:"error"})}},$=B(()=>{F()},2e3),y=async()=>{try{p(!0);const e=await(await d(`/api/posts/reply/${__postData.id}/?page=${h.current}`)).json();if(e.ok){if(e.code==="END_OF_PAGE"){p(!0);return}P(r=>r?[...r,...e.data]:e.data),p(!1);return}p(!1),n({message:e.message,type:"error"})}catch(t){p(!1),console.error(t),alert("Something went wrong while getting replies")}};return T(()=>{const t=async()=>{var e;try{const a=await(await d(`/api/posts/draft/${__postData.id}/`)).json();if(a.ok){(e=m.current)==null||e.setMarkdown(a.data.body);return}}catch(r){console.error(r),alert("Something went wrong while getting drafted post")}};y(),t()},[]),b(null,100,()=>{h.current++,y()},S),o("div",{className:`main ${i.container}`,children:[o(O,{}),o("div",{className:`pad container ${i.postContainer}`,children:[o("h2",{children:"Post :"}),o(D,{postData:__postData}),o("h3",{className:"mt-20 mb-30",children:"Post a reply :"}),o("div",{className:`mt-30 ${i.editorContainer}`,children:[o(j,{className:i.editor,onImageInput:v,onEditorInitialized:t=>{m.current=t},onCaretChange:()=>$(),autofocus:!1}),o("div",{className:`${i.filesContainer} ml-20`,children:[o("p",{className:"mb-20",children:"Attach notes :"}),o(R,{text:"Notes",multiple:!0,width:"100px",accept:".pdf",placeholder:o("ul",{style:{maxWidth:"120px"},className:"mt-20",children:l==null?void 0:l.map((t,e)=>o("li",{style:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},title:t.name,children:t.name},e))}),onInput:C})]})]}),o("div",{className:i.footer,children:[o("span",{"data-type":s==null?void 0:s.type,children:s==null?void 0:s.message}),o(M,{className:"mt-40",onClick:k,children:"Reply"})]}),o("h3",{className:"mt-20 mb-30",children:"Replies :"}),o("div",{children:c===null?o(x,{}):c.length===0?o("h3",{children:"No replies on this post. Be the first to reply."}):c==null?void 0:c.map((t,e)=>o(D,{isReply:!0,postData:t},e))})]})]})};I(o(G,{}),document.getElementById("root"));
